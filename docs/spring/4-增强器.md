---
title: 4、后置增强器
tags:
  - spring源码
categories:
  - spring
  - spring源码
cover: >-
  https://image.imxyu.cn/file/Bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%B5%81%E7%A8%8B.jpg
description: 三种增强器：BeanFactoryProcessor、BeanPostProcessor、initailizingBean
abbrlink: 63813ffa
date: 2021-12-08 21:28:43
---

# 三种增强器

## BeanFactoryProcessor

我们再来看看后置增强BeanFacatory的处理器

**BeanFactory**的后置增强器有两个

* **BeanFactoryProcessor**：对BeanFactory的后置增强
* **BeanDefinitionRegistryPostProcessor：Bean**定义信息的后置增强

![image-20211208190828104](https://image.imxyu.cn/file/image-20211208190828104.png)

> spring中都是面向接口的，底下都是多态实现，因此我们只用看接口就行

### 断点1.1-每个BeanFactory后置处理器

> 断点1.1、1.2、1.3先一起打上，debug看注释，然后打断点4看

![image-20211208203559335](https://image.imxyu.cn/file/image-20211208203559335.png)

## BeanPostProcessor

上一节我们看了**BeanPostProcessor**是Bean的后置处理器，用来增强组件。每一个子接口的增强器在何时运行，在于改变（比如@AutowiredPostProcessor在于改变自动装配的属性值）

**BeanPostProcessor**的后置处理器还有很多，都是对Bean的增强

![image-20211208191845311](https://image.imxyu.cn/file/image-20211208191845311.png)

> 其中DestructionAwareBeanPostProcessor 是和销毁有关的，POBBP是自己测试的。这俩不用管



### 断点1.2-每个Bean后置处理器

接下来我们实现所有的Bean后置处理器，看这些后置处理器是怎么工作的

![image-20211208192748341](https://image.imxyu.cn/file/image-20211208192748341.png)



![image-20211208192835305](https://image.imxyu.cn/file/image-20211208192835305.png)



剩下那两个也是同样，在每个方法上打断点



### 断点1.3-cat对象set赋值

接下来我们只用注解创建一个Cat对象（其他对象注解@Component取消），并且在对象set赋值的时候打断点

![image-20211208193359439](https://image.imxyu.cn/file/image-20211208193359439.png)

创建beans2.xml，只注册了cat对象和所有processor组件

![image-20211208193845168](https://image.imxyu.cn/file/image-20211208193845168.png)

使用xml方式进行debug

![image-20211208194012304](https://image.imxyu.cn/file/image-20211208194012304.png)



##　initailizingBean

还有一个Bean的生命周期处理器的接口**InitailizingBean**这个接口的功能也是Bean组件初始化以后对组件进行后续设置，在于额外处理



## spring的BeanFactoryProcessor

我们来看看BeanFactoryProcessor的作用是什么？ 这里看一下spring自己的BeanFactoryProcessor后置处理器是如何解析注解类将@ComponentScan、@Import这些注解的组件添加到容器的



### 断点2.1- MainConfig

因为要解析注解类，首先给MainConfig打上断点

![image-20211208212055538](https://image.imxyu.cn/file/image-20211208212055538.png)

### 断点2.2-AbstractApplicationContext

![image-20211208212652068](https://image.imxyu.cn/file/image-20211208212652068.png)

**使用注解容器类启动**：进行debug

> 断点2.1 和2.2一起打上看debug源码

![image-20211208212934042](https://image.imxyu.cn/file/image-20211208212934042.png)

> 下面列举简单的几张截图，详细的debug看注释

![image-20211208210554120](https://image.imxyu.cn/file/image-20211208210554120.png)

在这里可以看到spring自己定义的，该processor是为了给注解的配置文件（MainConfig）注册Bean定义信息的

![image-20211208205703478](https://image.imxyu.cn/file/image-20211208205703478.png)

---





![image-20211208204957901](https://image.imxyu.cn/file/image-20211208204957901.png)

直接获取spring的**配置类**的后置处理器

![image-20211208205242055](https://image.imxyu.cn/file/image-20211208205242055.png)

解析注解

![image-20211208210342975](https://image.imxyu.cn/file/image-20211208210342975.png)

各个注解的解析

![image-20211208210418091](https://image.imxyu.cn/file/image-20211208210418091.png)